<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«æ¨‚å­¸æ™‚é˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-yellow-50 min-h-screen">
    <div id="app"></div>

    <script>
        const COMPLIMENTS = ["å¤ªç¥å•¦ï¼ä½ ç­”å°äº†ï¼ğŸ¥³ğŸ‰", "ğŸ’¯ å®Œç¾ï¼çœŸæ˜¯å€‹æ™‚é–“å¤§å¸«ï¼", "ğŸŒŸ å“‡ï¼å®Œå…¨æ­£ç¢ºï¼è¶…ç´šå²å®³ï¼", "çµ¦ä½ ä¸€å€‹è®šï¼ğŸ‘ ç¹¼çºŒåŠ æ²¹ï¼", "å¤ªæ£’äº†ï¼ğŸ‘ ä½ çŸ¥é“ç­”æ¡ˆï¼"];
        
        let state = {
            screen: 'menu',
            questions: [],
            currentIdx: 0,
            userAnswers: [],
            input: {h: '', m: ''},
            focus: 'H',
            count: 20,
            interval: 'random',
            processing: false,
            reviewing: false,
            selectedReview: null
        };

        function generateTime(interval) {
            const h = Math.floor(Math.random() * 12) + 1;
            let m;
            switch(interval) {
                case 'hourly': m = 0; break;
                case 'half': m = 30; break;
                case 'five_min': m = Math.floor(Math.random() * 12) * 5; break;
                default: m = Math.floor(Math.random() * 60);
            }
            return {h, m};
        }

        function drawClock(h, m, size = 260) {
            const minAngle = m * 6;
            const hrAngle = ((h % 12) + m / 60) * 30;
            let svg = `<svg width="${size}" height="${size}" viewBox="0 0 100 100" class="drop-shadow-xl">
                <circle cx="50" cy="50" r="48" fill="#FFF" stroke="#F472B6" stroke-width="4"/>
                <circle cx="50" cy="50" r="45" fill="#FFF1F2"/>`;
            
            for(let i = 0; i < 60; i++) {
                const rot = i * 6;
                const isHr = i % 5 === 0;
                svg += `<line x1="50" y1="6" x2="50" y2="${6 + (isHr ? 6 : 3)}" transform="rotate(${rot} 50 50)" stroke="${isHr ? '#F472B6' : '#F9A8D4'}" stroke-width="${isHr ? 2 : 1}" stroke-linecap="round"/>`;
            }
            
            for(let i = 1; i <= 12; i++) {
                const ang = (i * 30 * Math.PI) / 180;
                const x = 50 + 35 * Math.sin(ang);
                const y = 50 - 35 * Math.cos(ang) + 1;
                svg += `<text x="${x}" y="${y}" dominant-baseline="middle" text-anchor="middle" class="font-bold fill-indigo-600" style="font-size:10px">${i}</text>`;
            }
            
            svg += `<line x1="50" y1="50" x2="50" y2="28" stroke="#8B5CF6" stroke-width="4" stroke-linecap="round" transform="rotate(${hrAngle} 50 50)"/>
                <line x1="50" y1="50" x2="50" y2="18" stroke="#06B6D4" stroke-width="3" stroke-linecap="round" transform="rotate(${minAngle} 50 50)"/>
                <circle cx="50" cy="50" r="3" fill="#F472B6"/></svg>`;
            return svg;
        }

        function formatTime(h, m) {
            return `${h}:${m.toString().padStart(2, '0')}`;
        }

        function isCorrect(q, a) {
            return q && a && q.h === a.h && q.m === a.m;
        }

        function showMessage(text, type) {
            const msg = document.createElement('div');
            msg.className = `fixed top-4 left-1/2 -translate-x-1/2 p-4 rounded-full shadow-2xl z-50 font-bold text-xl ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white`;
            msg.textContent = text;
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), type === 'success' ? 1500 : 2000);
        }

        function startGame() {
            state.questions = Array.from({length: state.count}, () => generateTime(state.interval));
            state.screen = 'playing';
            state.currentIdx = 0;
            state.userAnswers = [];
            state.input = {h: '', m: ''};
            state.focus = 'H';
            state.processing = false;
            state.reviewing = false;
            render();
        }

        function handleInput(num) {
            if(state.processing || state.reviewing) return;
            const field = state.focus === 'H' ? 'h' : 'm';
            let val = state.input[field] + num;
            const intVal = parseInt(val);
            
            if(field === 'h') {
                if(intVal > 12 || (intVal === 0 && val.length === 2)) val = state.input[field];
                else if(val.length === 2 && intVal <= 12) setTimeout(() => {state.focus = 'M'; render();}, 150);
            } else {
                if(intVal > 59) val = state.input[field];
            }
            
            if(val.length <= 2) state.input[field] = val;
            render();
        }

        function handleDelete() {
            if(state.processing || state.reviewing) return;
            const field = state.focus === 'H' ? 'h' : 'm';
            state.input[field] = state.input[field].slice(0, -1);
            render();
        }

        function handleConfirm() {
            if(state.processing || state.reviewing) return;
            
            if(!state.input.h) {showMessage("è«‹å…ˆè¼¸å…¥å°æ™‚å–”ï¼", 'error'); return;}
            if(!state.input.m) {showMessage("è«‹è¼¸å…¥åˆ†é˜å–”ï¼", 'error'); return;}
            
            const h = parseInt(state.input.h);
            const m = parseInt(state.input.m);
            
            if(h < 1 || h > 12 || m < 0 || m > 59) {
                showMessage("è¼¸å…¥æ™‚é–“è¶…å‡ºç¯„åœï¼ˆå°æ™‚1-12ï¼Œåˆ†é˜0-59ï¼‰ã€‚", 'error');
                return;
            }
            
            state.processing = true;
            const ans = {h, m};
            state.userAnswers.push(ans);
            const correct = isCorrect(state.questions[state.currentIdx], ans);
            
            if(correct) {
                showMessage(COMPLIMENTS[Math.floor(Math.random() * COMPLIMENTS.length)], 'success');
                setTimeout(goNext, 1500);
            } else {
                showMessage("ç­”éŒ¯äº†ï¼æ²’é—œä¿‚ï¼Œè®“æˆ‘å€‘çœ‹çœ‹æ­£ç¢ºç­”æ¡ˆã€‚", 'error');
                state.reviewing = true;
                render();
            }
        }

        function goNext() {
            state.reviewing = false;
            state.input = {h: '', m: ''};
            state.focus = 'H';
            state.processing = false;
            
            if(state.currentIdx < state.questions.length - 1) {
                state.currentIdx++;
                render();
            } else {
                state.screen = 'results';
                render();
            }
        }

        function returnToMenu() {
            state = {screen: 'menu', questions: [], currentIdx: 0, userAnswers: [], input: {h: '', m: ''}, focus: 'H', count: 20, interval: 'random', processing: false, reviewing: false, selectedReview: null};
            render();
        }

        function renderMenu() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="bg-white rounded-[3rem] shadow-2xl p-8 max-w-md w-full text-center border-8 border-white ring-4 ring-yellow-200">
                        <div class="mb-6 flex justify-center text-pink-500">
                            <svg width="80" height="80" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="40" cy="40" r="35"/><polyline points="40 15 40 40 55 47"/>
                            </svg>
                        </div>
                        <h1 class="text-4xl font-black text-indigo-500 mb-6">å¿«æ¨‚å­¸æ™‚é˜</h1>
                        
                        <div class="space-y-6 text-left">
                            <div>
                                <h3 class="text-xl font-bold text-gray-700 mb-3">â–¶ é¸æ“‡é¡Œç›®æ•¸é‡</h3>
                                <div class="flex gap-4 justify-center">
                                    ${[20, 30].map(c => `<button onclick="state.count=${c};render()" class="py-3 px-6 rounded-xl text-lg font-black shadow-md ${state.count === c ? 'bg-pink-500 text-white' : 'bg-white text-pink-500 border-2 border-pink-200'}">${c} é¡Œ</button>`).join('')}
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="text-xl font-bold text-gray-700 mb-3">â–¶ é¸æ“‡æ¸¬é©—é¡å‹</h3>
                                <div class="grid grid-cols-2 gap-3">
                                    ${[{k:'hourly',l:'æ•´é» (å¦‚ 3:00)'},{k:'half',l:'åŠé» (å¦‚ 3:30)'},{k:'five_min',l:'äº”åˆ†é˜ (å¦‚ 3:05)'},{k:'random',l:'éš¨æ©Ÿåˆ†é˜'}].map(o => 
                                        `<button onclick="state.interval='${o.k}';render()" class="py-2 px-4 rounded-xl text-sm font-medium ${state.interval === o.k ? 'bg-teal-500 text-white' : 'bg-white text-teal-600 border-2 border-teal-200'}">${o.l}</button>`
                                    ).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="startGame()" class="w-full mt-8 py-5 bg-gradient-to-r from-yellow-400 to-orange-400 text-white rounded-2xl text-2xl font-black shadow-[0_6px_0_0_#D97706] active:translate-y-2 transition-all">
                            â–¶ é–‹å§‹æŒ‘æˆ° (${state.count} é¡Œ)
                        </button>
                    </div>
                </div>`;
        }

        function renderPlaying() {
            const q = state.questions[state.currentIdx];
            const lastAns = state.userAnswers[state.userAnswers.length - 1];
            const disabled = state.processing || state.reviewing;
            
            return `
                <div class="min-h-screen bg-blue-50 flex flex-col items-center p-4">
                    <button onclick="returnToMenu()" class="fixed top-4 left-4 p-3 bg-white text-indigo-500 rounded-full shadow-lg z-50">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                    
                    <div class="w-full max-w-md pt-16 space-y-6">
                        <div class="flex justify-between items-center px-2">
                            <span class="text-indigo-400 font-black bg-white px-4 py-2 rounded-full shadow-lg">ç¬¬ ${state.currentIdx + 1} / ${state.questions.length} é¡Œ</span>
                            <div class="flex gap-1">
                                ${state.questions.map((_, i) => `<div class="w-3 h-3 rounded-full ${i === state.currentIdx ? 'bg-pink-400 animate-pulse' : i < state.currentIdx ? 'bg-teal-400' : 'bg-gray-200'}"></div>`).join('')}
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-[3rem] shadow-xl border-4 border-indigo-50">
                            ${drawClock(q.h, q.m)}
                        </div>
                        
                        <div class="text-center">
                            <h2 class="text-2xl font-black text-indigo-600 mb-1">ç¾åœ¨å¹¾é»å‘¢ï¼Ÿ</h2>
                            <p class="text-gray-400 font-medium">è§€å¯Ÿæ™‚é˜ï¼Œè¼¸å…¥æ­£ç¢ºçš„æ•¸å­—</p>
                        </div>
                        
                        ${!state.reviewing ? `
                            <div class="flex flex-col gap-4 w-full max-w-xs mx-auto">
                                <div class="flex justify-center gap-3 mb-2">
                                    <div onclick="${disabled ? '' : "state.focus='H';render()"}" class="relative p-4 rounded-2xl border-4 text-3xl font-black w-24 text-center cursor-pointer ${state.focus === 'H' ? 'border-pink-400 bg-pink-50 text-pink-600 shadow-lg' : 'border-gray-100 bg-white text-gray-400'} ${disabled ? 'opacity-50' : ''}">
                                        ${state.input.h || '?'}
                                        ${state.focus === 'H' && !disabled ? '<div class="absolute -top-2 -right-2 text-yellow-400">â­</div>' : ''}
                                    </div>
                                    <span class="text-3xl font-black text-indigo-300">:</span>
                                    <div onclick="${disabled ? '' : "state.focus='M';render()"}" class="relative p-4 rounded-2xl border-4 text-3xl font-black w-24 text-center cursor-pointer ${state.focus === 'M' ? 'border-cyan-400 bg-cyan-50 text-cyan-600 shadow-lg' : 'border-gray-100 bg-white text-gray-400'} ${disabled ? 'opacity-50' : ''}">
                                        ${state.input.m || '?'}
                                        ${state.focus === 'M' && !disabled ? '<div class="absolute -top-2 -right-2 text-yellow-400">â­</div>' : ''}
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-3 gap-3">
                                    ${[1,2,3,4,5,6,7,8,9].map(n => `<button onclick="handleInput(${n})" ${disabled ? 'disabled' : ''} class="p-4 bg-white rounded-2xl border-2 border-indigo-50 text-2xl font-black text-indigo-500 hover:bg-indigo-50 active:translate-y-1 ${disabled ? 'opacity-50' : ''}">${n}</button>`).join('')}
                                    <button onclick="handleDelete()" ${disabled ? 'disabled' : ''} class="p-4 bg-red-50 rounded-2xl border-2 border-red-100 text-xl font-bold text-red-400 hover:bg-red-100 active:translate-y-1 ${disabled ? 'opacity-50' : ''}">âŒ«</button>
                                    <button onclick="handleInput(0)" ${disabled ? 'disabled' : ''} class="p-4 bg-white rounded-2xl border-2 border-indigo-50 text-2xl font-black text-indigo-500 hover:bg-indigo-50 active:translate-y-1 ${disabled ? 'opacity-50' : ''}">0</button>
                                    <button onclick="handleConfirm()" ${disabled ? 'disabled' : ''} class="p-4 bg-gradient-to-r from-pink-400 to-rose-400 rounded-2xl text-white text-xl font-black hover:from-pink-500 hover:to-rose-500 active:translate-y-1 ${disabled ? 'opacity-50' : ''}">OK âœ“</button>
                                </div>
                            </div>
                        ` : ''}
                        
                        ${state.reviewing && lastAns ? `
                            <div class="fixed inset-0 bg-blue-50/90 backdrop-blur-sm flex items-center justify-center p-8 z-40">
                                <div class="bg-white rounded-3xl p-6 shadow-2xl border-4 border-red-400 max-w-sm text-center">
                                    <h3 class="text-3xl font-black text-red-600 mb-4">ç­”éŒ¯å›‰ï¼</h3>
                                    <p class="text-lg text-gray-700 mb-2">ä½ è¼¸å…¥ï¼š<span class="text-red-500 font-extrabold">${formatTime(lastAns.h, lastAns.m)}</span></p>
                                    <p class="text-xl font-extrabold text-green-600 mb-4">æ­£ç¢ºç­”æ¡ˆï¼š${formatTime(q.h, q.m)}</p>
                                    <div class="mb-6">${drawClock(q.h, q.m, 150)}</div>
                                    <button onclick="goNext()" class="w-full py-4 bg-gradient-to-r from-teal-400 to-green-400 text-white rounded-xl text-xl font-black shadow-[0_4px_0_0_#065F46] active:translate-y-1">ä¸‹ä¸€é¡Œï¼ğŸ’ª</button>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>`;
        }

        function renderResults() {
            const score = state.questions.filter((q, i) => state.userAnswers[i] && isCorrect(q, state.userAnswers[i])).length;
            const perfect = score === state.questions.length;
            
            return `
                <div class="min-h-screen bg-pink-50 flex flex-col items-center p-4">
                    <button onclick="returnToMenu()" class="fixed top-4 left-4 p-3 bg-white text-indigo-500 rounded-full shadow-lg z-50">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                    </button>
                    
                    <div class="w-full max-w-lg bg-white rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col max-h-[90vh] border-4 border-white ring-4 ring-pink-100 mt-16">
                        <div class="p-8 text-center text-white ${perfect ? 'bg-gradient-to-br from-yellow-400 to-orange-400' : 'bg-gradient-to-br from-indigo-500 to-purple-500'}">
                            <div class="text-5xl mb-2">${perfect ? 'â­' : 'ğŸ•'}</div>
                            <h2 class="text-3xl font-black mb-2">${perfect ? 'ä½ çœŸæ˜¯å€‹æ™‚é–“å¤§å¸«ï¼' : 'å¾ˆæ£’çš„ç·´ç¿’ï¼'}</h2>
                            <p class="text-xl font-bold">å¾—åˆ†ï¼š ${score} / ${state.questions.length} åˆ†</p>
                        </div>
                        
                        <div class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50/50">
                            ${state.selectedReview !== null ? `
                                <div class="bg-white rounded-3xl border-4 border-yellow-200 p-4 relative shadow-xl">
                                    <button onclick="state.selectedReview=null;render()" class="absolute top-3 right-3 p-2 bg-gray-100 rounded-full text-gray-400 hover:bg-gray-200">âœ•</button>
                                    <div class="bg-yellow-100 text-yellow-700 px-4 py-1 rounded-full text-sm font-bold mb-4 inline-block">ç¬¬ ${state.selectedReview + 1} é¡Œï¼šé¡Œç›®å›é¡§</div>
                                    <div class="mb-4 flex justify-center">${drawClock(state.questions[state.selectedReview].h, state.questions[state.selectedReview].m, 200)}</div>
                                    <div class="flex gap-4">
                                        <div class="flex-1 bg-red-50 p-3 rounded-2xl border-2 border-red-100 text-center">
                                            <div class="text-xs text-red-400 font-bold mb-1">ä½ çš„ç­”æ¡ˆ</div>
                                            <div class="text-2xl font-black ${state.userAnswers[state.selectedReview] && isCorrect(state.questions[state.selectedReview], state.userAnswers[state.selectedReview]) ? 'text-green-500' : 'text-red-500'}">
                                                ${state.userAnswers[state.selectedReview] ? formatTime(state.userAnswers[state.selectedReview].h, state.userAnswers[state.selectedReview].m) : '--:--'}
                                            </div>
                                        </div>
                                        <div class="flex-1 bg-green-50 p-3 rounded-2xl border-2 border-green-100 text-center">
                                            <div class="text-xs text-green-600 font-bold mb-1">æ­£ç¢ºç­”æ¡ˆ</div>
                                            <div class="text-2xl font-black text-green-600">${formatTime(state.questions[state.selectedReview].h, state.questions[state.selectedReview].m)}</div>
                                        </div>
                                    </div>
                                </div>
                            ` : `
                                <div class="text-center py-4 bg-white/50 border-2 border-dashed border-indigo-200 rounded-2xl text-indigo-400 font-bold text-sm">
                                    ğŸ‘‡ é»æ“Šä¸‹æ–¹åˆ—è¡¨è¤‡ç¿’é¡Œç›®
                                </div>
                            `}
                            
                            <div class="space-y-3">
                                ${state.questions.map((q, i) => {
                                    const ans = state.userAnswers[i];
                                    const correct = ans && isCorrect(q, ans);
                                    const selected = state.selectedReview === i;
                                    return `
                                        <button onclick="state.selectedReview=${i};render()" class="w-full flex items-center justify-between p-4 rounded-2xl border-b-4 ${selected ? 'bg-yellow-50 border-yellow-300 ring-2 ring-yellow-200' : 'bg-white border-gray-200 shadow-sm'}">
                                            <div class="flex items-center gap-4">
                                                <div class="w-10 h-10 rounded-full flex items-center justify-center shadow-md ${correct ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-500'}">
                                                    ${correct ? 'âœ“' : 'âœ•'}
                                                </div>
                                                <span class="font-bold text-gray-700 text-lg">ç¬¬ ${i + 1} é¡Œ</span>
                                            </div>
                                            ${!selected ? '<span class="text-sm font-bold text-indigo-300 bg-indigo-50 px-2 py-1 rounded-lg">æŸ¥çœ‹è©³æƒ…</span>' : ''}
                                        </button>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <div class="p-4 bg-white border-t">
                            <button onclick="returnToMenu()" class="w-full py-4 bg-gray-800 hover:bg-gray-900 text-white rounded-2xl font-black shadow-lg active:scale-95">â†» è¿”å›é¸å–®/å†ç©ä¸€æ¬¡</button>
                        </div>
                    </div>
                </div>`;
        }

        function render() {
            let html = '';
            if(state.screen === 'menu') html = renderMenu();
            else if(state.screen === 'playing') html = renderPlaying();
            else if(state.screen === 'results') html = renderResults();
            document.getElementById('app').innerHTML = html;
        }

        render();
    </script>
</body>
</html>
